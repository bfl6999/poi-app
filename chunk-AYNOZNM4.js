import{a as be}from"./chunk-6DRDY65T.js";import{A as ge,B as _e,C as fe,D as xe,E as Ie,I as he,b as X,d as Y,e as Z,f as ee,g as te,h as ie,i as ne,j as oe,k as re,m as ae,p as le,r as me,s as se,t as ce,u as de,v as ue,w as pe}from"./chunk-C4635AQ6.js";import"./chunk-RXWWUHP3.js";import"./chunk-QUJFQN2Y.js";import"./chunk-S3FFCQW7.js";import"./chunk-DOTHXVNP.js";import"./chunk-AWJPMP66.js";import"./chunk-DZ63SHBZ.js";import"./chunk-N3ULCH4Z.js";import"./chunk-A6U5T4IK.js";import"./chunk-BYMGTA2M.js";import"./chunk-FFMQGMXV.js";import"./chunk-WVCYVA7Q.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-BQTEGPC7.js";import"./chunk-CKP3SGE2.js";import"./chunk-M7AYFT6S.js";import"./chunk-R265GKSD.js";import{$a as g,C as d,Da as q,G as m,H as o,I as n,J as I,K as E,L as v,N as h,O as b,P as c,W as P,X as r,Y as u,Z as C,ab as G,bb as H,da as O,ea as T,ec as Ce,fa as N,fb as z,gb as $,ha as D,hb as J,j as y,ka as V,kb as K,kc as k,la as L,lb as Q,lc as Ee,m as _,ma as R,mb as W,n as f,nc as ve,oa as B,pa as M,u as F,v as l,w as x,wa as A,y as w,ya as j,za as U}from"./chunk-CP2QVCAP.js";import"./chunk-EVXCY5NW.js";import"./chunk-JXNEG2Q2.js";import"./chunk-FUY72XGA.js";import"./chunk-EQDBGDMV.js";import"./chunk-WESY2VG5.js";import"./chunk-M2X7KQLB.js";import"./chunk-XTVTS2NW.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{f as S}from"./chunk-D7YYRZS5.js";var Se=i=>["/edit-poi",i];function Pe(i,s){if(i&1){let e=h();E(0),o(1,"ion-button",7),b("click",function(){_(e);let a=c();return f(a.logout())}),r(2,"Cerrar sesi\xF3n"),n(),o(3,"ion-button",8),r(4),n(),v()}if(i&2){let e=s.ngIf;l(4),C(" ",e.displayName||e.email," ")}}function De(i,s){i&1&&(o(0,"ion-button",9),r(1,"Iniciar sesi\xF3n"),n(),o(2,"ion-button",10),r(3,"Registrarse"),n())}function ke(i,s){if(i&1&&I(0,"img",21),i&2){let e=c(2);m("src",e.poi.imageUrl,F)("ngClass",e.isIconImage(e.poi.imageUrl)?"poi-image-icon":"poi-image-real")}}function ye(i,s){if(i&1){let e=h();o(0,"ion-button",23),b("click",function(){_(e);let a=c().$implicit,p=c(2);return f(p.deleteComment(a._id))}),r(1," Eliminar "),n()}}function Fe(i,s){if(i&1&&(o(0,"ion-item")(1,"ion-label")(2,"h3"),r(3),n(),o(4,"p"),r(5),n(),o(6,"p"),r(7),n()(),d(8,ye,2,0,"ion-button",22),n()),i&2){let e=s.$implicit,t=c(2);l(3),u(e.author),l(2),u(e.comment),l(2),C("\u2B50 ",e.stars,"/5"),l(),m("ngIf",(t.user==null?null:t.user.uid)&&e.userUid===(t.user==null?null:t.user.uid))}}function we(i,s){i&1&&(E(0),o(1,"ion-item")(2,"ion-label",15),r(3,"Usuario"),n(),I(4,"ion-input",24),n(),v())}function Oe(i,s){if(i&1&&(E(0),o(1,"ion-item")(2,"ion-label"),r(3," Comentando como: "),o(4,"strong"),r(5),n()()(),v()),i&2){let e=s.ngIf;l(5),u(e.displayName)}}function Te(i,s){if(i&1&&d(0,Oe,6,1,"ng-container",25),i&2){let e=c(2);m("ngIf",e.user)}}function Ne(i,s){if(i&1){let e=h();o(0,"ion-button",26),b("click",function(){_(e);let a=c(2);return f(a.deletePoi())}),r(1," Eliminar POI "),n()}}function Ve(i,s){if(i&1&&(o(0,"ion-button",27),r(1," Editar POI "),n()),i&2){let e=c(2);m("routerLink",O(1,Se,e.poi._id))}}function Le(i,s){if(i&1){let e=h();o(0,"ion-content",11)(1,"ion-card"),d(2,ke,1,2,"img",12),o(3,"ion-card-header")(4,"ion-card-title"),r(5),n(),o(6,"ion-card-subtitle"),r(7),n()(),o(8,"ion-card-content")(9,"p"),r(10),n(),o(11,"p")(12,"strong"),r(13,"Fecha:"),n(),r(14),T(15,"date"),n(),o(16,"p")(17,"strong"),r(18,"Rating Promedio:"),n(),r(19),n()()(),o(20,"ion-list")(21,"ion-list-header"),r(22,"Comentarios"),n(),d(23,Fe,9,4,"ion-item",13),n(),o(24,"form",14),b("ngSubmit",function(){_(e);let a=c();return f(a.submitComment())}),d(25,we,5,0,"ng-container",5)(26,Te,1,1,"ng-template",null,1,D),o(28,"ion-item")(29,"ion-label",15),r(30,"Comentario"),n(),I(31,"ion-textarea",16),n(),o(32,"ion-item")(33,"ion-label",15),r(34,"Estrellas"),n(),o(35,"ion-range",17)(36,"ion-label",2),r(37,"1"),n(),o(38,"ion-label",4),r(39,"5"),n()()(),o(40,"ion-button",18),r(41,"Enviar"),n()(),d(42,Ne,2,0,"ion-button",19)(43,Ve,2,3,"ion-button",20),n()}if(i&2){let e=P(27),t=c();l(2),m("ngIf",t.poi.imageUrl),l(3),u(t.poi.name),l(2),u(t.poi.location),l(3),u(t.poi.description),l(4),C(" ",N(15,13,t.poi.dateAdded)),l(5),C(" ",t.averageRating.toFixed(1),"/5"),l(4),m("ngForOf",t.poi.comments),l(),m("formGroup",t.commentForm),l(),m("ngIf",!t.user)("ngIfElse",e),l(15),m("disabled",t.commentForm.invalid),l(2),m("ngIf",t.canDeletePoi),l(),m("ngIf",t.canDeletePoi)}}var Xe=(()=>{class i{constructor(e,t,a,p){this.route=e,this.poiService=t,this.fb=a,this.auth=p,this.poi=null,this.poiId="",this.user=null,this.canDeletePoi=!1,this.router=y(j)}ngOnInit(){this.commentForm=this.fb.group({username:[""],comment:["",[g.required,g.maxLength(1e3)]],stars:[5,[g.required,g.min(1),g.max(5)]]}),this.poiId=this.route.snapshot.paramMap.get("id")||"",Ee(this.auth,e=>{this.user=e,this.poiId&&this.loadPOI()})}loadPOI(){console.log(this.poi?.comments),this.poiService.getPOI(this.poiId).subscribe({next:e=>{this.poi=e,this.evaluateCanDelete()},error:e=>console.error("Error cargando detalle",e)})}evaluateCanDelete(){if(!this.user||!this.poi||!this.poi.insertedBy){this.canDeletePoi=!1;return}this.canDeletePoi=this.poi.insertedBy===this.user.uid}get averageRating(){return!this.poi?.comments||this.poi.comments.length===0?0:this.poi.comments.reduce((t,a)=>t+a.stars,0)/this.poi.comments.length}submitComment(){this.commentForm.invalid||navigator.geolocation.getCurrentPosition(e=>{let t={author:this.user?.displayName||this.commentForm.value.username?.trim()||"An\xF3nimo",userUid:this.user?.uid||null,comment:this.commentForm.value.comment,stars:this.commentForm.value.stars,location:{lat:e.coords.latitude,lng:e.coords.longitude},createdAt:new Date().toISOString()};this.poiService.addComment(this.poiId,t).subscribe({next:()=>{this.commentForm.reset({comment:"",stars:5}),this.loadPOI()},error:a=>console.error("Error al comentar",a)})},e=>{alert("No se pudo obtener la ubicaci\xF3n")})}isAuthenticated(){return this.user!==null}logout(){ve(this.auth).then(()=>{this.router.navigate(["/home"])})}deletePoi(){return S(this,null,function*(){if(!(!this.user||!this.poi?._id||!confirm("\xBFEst\xE1s seguro de que quieres eliminar este POI?")))try{let t=yield k(this.user);this.poiService.deletePOI(this.poi._id,t).subscribe({next:()=>{alert("POI eliminado correctamente"),this.router.navigate(["/home"])},error:a=>{console.error("Error al eliminar el POI:",a),alert("Error al eliminar el POI")}})}catch(t){console.error("Error obteniendo token:",t),alert("Error de autenticaci\xF3n")}})}deleteComment(e){return S(this,null,function*(){if(!(!this.user||!this.poiId||!confirm("\xBFEst\xE1s seguro de que quieres eliminar este comentario?")))try{let a=yield k(this.user);this.poiService.deleteComment(this.poiId,e,a).subscribe({next:()=>{alert("Comentario eliminado"),this.loadPOI()},error:p=>{console.error("Error eliminando comentario:",p),alert("Error eliminando comentario")}})}catch(a){console.error("Error autenticando usuario:",a)}})}isIconImage(e){return e?e.includes("categories")||e.includes("/icons/")||e.includes("default"):!1}static{this.\u0275fac=function(t){return new(t||i)(x(A),x(be),x(K),x(Ce))}}static{this.\u0275cmp=w({type:i,selectors:[["app-detail"]],decls:11,vars:4,consts:[["notLoggedIn",""],["loggedInBlock",""],["slot","start"],["defaultHref","/home"],["slot","end"],[4,"ngIf","ngIfElse"],["class","ion-padding",4,"ngIf"],["fill","clear",3,"click"],["fill","clear","disabled",""],["fill","clear","routerLink","/login"],["fill","clear","routerLink","/register"],[1,"ion-padding"],["alt","Imagen del POI",3,"src","ngClass",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngSubmit","formGroup"],["position","stacked"],["formControlName","comment"],["min","1","max","5","step","1","snaps","true","formControlName","stars"],["expand","full","type","submit",3,"disabled"],["fill","outline","color","danger",3,"click",4,"ngIf"],["fill","outline","color","warning",3,"routerLink",4,"ngIf"],["alt","Imagen del POI",3,"src","ngClass"],["fill","clear","color","danger","size","small",3,"click",4,"ngIf"],["fill","clear","color","danger","size","small",3,"click"],["formControlName","username"],[4,"ngIf"],["fill","outline","color","danger",3,"click"],["fill","outline","color","warning",3,"routerLink"]],template:function(t,a){if(t&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),r(3),n(),o(4,"ion-buttons",2),I(5,"ion-back-button",3),n(),o(6,"ion-buttons",4),d(7,Pe,5,1,"ng-container",5)(8,De,4,0,"ng-template",null,0,D),n()()(),d(10,Le,44,15,"ion-content",6)),t&2){let p=P(9);l(3),u(a.poi==null?null:a.poi.name),l(4),m("ngIf",a.user)("ngIfElse",p),l(3),m("ngIf",a.poi)}},dependencies:[M,V,L,R,B,Q,z,G,H,W,$,J,he,Z,ee,te,ie,ne,oe,re,ae,le,me,se,ce,de,ue,pe,ge,_e,fe,X,Y,xe,Ie,q,U],styles:[".poi-image-real[_ngcontent-%COMP%]{width:50%;border-radius:12px;object-fit:cover;box-shadow:0 4px 12px #0000001a;margin:16px auto;display:block}.poi-image-icon[_ngcontent-%COMP%]{background-color:#979797;padding:10px;border-radius:12px;width:100px;height:100px;object-fit:contain;margin:16px auto;display:block;box-shadow:0 0 5px #00000026}"]})}}return i})();export{Xe as DetailPage};
