import{a as ce}from"./chunk-6DRDY65T.js";import{B as ne,C as oe,D as re,H as se,I as ae,a as W,d as N,e as U,f as D,g as z,h as G,i as R,k as $,l as J,m as K,p as Q,q as X,r as Y,s as Z,t as ee,u as te,v as ie}from"./chunk-C4635AQ6.js";import"./chunk-RXWWUHP3.js";import"./chunk-QUJFQN2Y.js";import"./chunk-S3FFCQW7.js";import"./chunk-DOTHXVNP.js";import"./chunk-AWJPMP66.js";import"./chunk-DZ63SHBZ.js";import"./chunk-N3ULCH4Z.js";import"./chunk-A6U5T4IK.js";import"./chunk-BYMGTA2M.js";import"./chunk-FFMQGMXV.js";import"./chunk-WVCYVA7Q.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-BQTEGPC7.js";import"./chunk-CKP3SGE2.js";import"./chunk-M7AYFT6S.js";import{a as le}from"./chunk-R265GKSD.js";import{$ as x,C as P,G as p,H as r,I as o,J as d,N as y,O as g,P as u,X as a,Y as w,Z as S,_ as q,aa as b,ab as j,ba as C,eb as L,ec as de,f as k,i as E,kc as v,la as F,lb as A,lc as ue,m as _,ma as M,n as I,pa as T,ra as B,sa as H,ta as V,v as s,w as m,y as O}from"./chunk-CP2QVCAP.js";import"./chunk-EVXCY5NW.js";import"./chunk-JXNEG2Q2.js";import"./chunk-FUY72XGA.js";import"./chunk-EQDBGDMV.js";import"./chunk-WESY2VG5.js";import"./chunk-M2X7KQLB.js";import"./chunk-XTVTS2NW.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{f as h}from"./chunk-D7YYRZS5.js";var me=(()=>{class n{constructor(e){this.http=e,this.apiUrl=`${le.apiUrl}/foursquare`}search(e,i,t){let c=new B().set("Authorization",`Bearer ${t}`),l=new H().set("query",e).set("near",i);return this.http.get(`${this.apiUrl}/search`,{headers:c,params:l})}static{this.\u0275fac=function(i){return new(i||n)(E(V))}}static{this.\u0275prov=k({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function ge(n,f){if(n&1){let e=y();r(0,"ion-item",11),g("click",function(){let t=_(e).$implicit,c=u(2);return I(c.toggleSelection(t))}),r(1,"ion-label")(2,"h2"),a(3),o(),r(4,"p"),a(5),d(6,"br"),a(7),o()(),d(8,"ion-checkbox",12),o()}if(n&2){let e=f.$implicit,i=u(2);s(3),w(e.name),s(2),S(" ",(e.location==null?null:e.location.formatted_address)||"Sin direcci\xF3n"),s(2),q(" Lat: ",e.geocodes==null||e.geocodes.main==null?null:e.geocodes.main.latitude," | Lng: ",e.geocodes==null||e.geocodes.main==null?null:e.geocodes.main.longitude," "),s(),p("checked",i.selectedPOIs.includes(e))}}function fe(n,f){if(n&1&&(r(0,"ion-list")(1,"ion-list-header")(2,"ion-label"),a(3,"Resultados encontrados"),o()(),P(4,ge,9,5,"ion-item",10),o()),n&2){let e=u();s(4),p("ngForOf",e.results)}}function _e(n,f){if(n&1){let e=y();r(0,"ion-button",13),g("click",function(){_(e);let t=u();return I(t.saveSelectedPOIs())}),d(1,"ion-icon",14),a(2),o()}if(n&2){let e=u();s(2),S(" Guardar seleccionados (",e.selectedPOIs.length,") ")}}var qe=(()=>{class n{constructor(e,i,t,c){this.fsService=e,this.poiService=i,this.auth=t,this.toastCtrl=c,this.query="",this.city="",this.results=[],this.selectedPOIs=[],this.user=null,this.loading=!1}ngOnInit(){ue(this.auth,e=>{this.user=e})}search(){return h(this,null,function*(){if(!this.query||!this.city){alert("Por favor, completa todos los campos.");return}if(!this.user){alert("Usuario no autenticado.");return}try{let e=yield v(this.user);this.loading=!0,this.fsService.search(this.query,this.city,e).subscribe({next:i=>this.results=i,error:i=>{console.error("Error buscando en Foursquare",i),alert("Error al buscar en Foursquare.")},complete:()=>this.loading=!1})}catch(e){console.error("Error obteniendo token:",e),alert("Error al autenticar usuario.")}})}toggleSelection(e){let i=this.selectedPOIs.findIndex(t=>t.fsq_id===e.fsq_id);i>=0?this.selectedPOIs.splice(i,1):this.selectedPOIs.push(e)}saveSelectedPOIs(){return h(this,null,function*(){if(!(!this.user||this.selectedPOIs.length===0))try{let e=yield v(this.user),i=this.selectedPOIs.map(t=>t.fsq_id);this.poiService.addMultiplePOIsFromFsqIds(i,e).subscribe({next:()=>h(this,null,function*(){(yield this.toastCtrl.create({message:"POIs guardados correctamente",duration:2e3,color:"success"})).present(),this.selectedPOIs=[]}),error:t=>{console.error("Error guardando POIs:",t),alert("Error al guardar los POIs.")}})}catch(e){console.error("Error obteniendo token:",e)}})}static{this.\u0275fac=function(i){return new(i||n)(m(me),m(ce),m(de),m(se))}}static{this.\u0275cmp=O({type:n,selectors:[["app-search-poi"]],decls:25,vars:4,consts:[["color","primary"],["slot","start"],["defaultHref","/home"],[1,"ion-padding"],["position","floating"],["type","text",3,"ngModelChange","ngModel"],["expand","block","color","primary",3,"click"],["name","search","slot","start"],[4,"ngIf"],["expand","block","color","success",3,"click",4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["slot","end",3,"checked"],["expand","block","color","success",3,"click"],["name","save-outline","slot","start"]],template:function(i,t){i&1&&(r(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),a(3,"Buscar POIs en Foursquare"),o(),r(4,"ion-buttons",1),d(5,"ion-back-button",2),o()()(),r(6,"ion-content",3)(7,"ion-card")(8,"ion-card-header")(9,"ion-card-title"),a(10,"B\xFAsqueda"),o()(),r(11,"ion-card-content")(12,"ion-item")(13,"ion-label",4),a(14,"Nombre del lugar"),o(),r(15,"ion-input",5),C("ngModelChange",function(l){return b(t.query,l)||(t.query=l),l}),o()(),r(16,"ion-item")(17,"ion-label",4),a(18,"Ciudad"),o(),r(19,"ion-input",5),C("ngModelChange",function(l){return b(t.city,l)||(t.city=l),l}),o()(),r(20,"ion-button",6),g("click",function(){return t.search()}),d(21,"ion-icon",7),a(22," Buscar "),o()()(),P(23,fe,5,1,"ion-list",8)(24,_e,3,1,"ion-button",9),o()),i&2&&(s(15),x("ngModel",t.query),s(4),x("ngModel",t.city),s(4),p("ngIf",t.results.length>0),s(),p("ngIf",t.selectedPOIs.length>0))},dependencies:[T,F,M,A,j,L,ae,U,D,z,G,R,$,J,K,Q,X,Y,Z,ee,te,ie,ne,oe,W,N,re],encapsulation:2})}}return n})();export{qe as SearchPoiPage};
