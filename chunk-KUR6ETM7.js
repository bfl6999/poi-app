import{B as X,C as Y,D as Z,F as ee,I as te,d as B,e as H,f as j,g as L,h as D,i as z,k as $,m as q,p as J,r as K,s as Q,t as U,u as W}from"./chunk-C4635AQ6.js";import"./chunk-RXWWUHP3.js";import"./chunk-QUJFQN2Y.js";import"./chunk-S3FFCQW7.js";import"./chunk-DOTHXVNP.js";import"./chunk-AWJPMP66.js";import"./chunk-DZ63SHBZ.js";import"./chunk-N3ULCH4Z.js";import"./chunk-A6U5T4IK.js";import"./chunk-BYMGTA2M.js";import"./chunk-FFMQGMXV.js";import"./chunk-WVCYVA7Q.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-BQTEGPC7.js";import"./chunk-CKP3SGE2.js";import"./chunk-M7AYFT6S.js";import{$a as T,C as c,G as u,H as o,I as t,J as f,N as C,O as h,P as g,X as s,Y as R,Z as y,_ as x,ab as k,bb as F,c as _,ec as re,fb as P,gb as N,hb as A,kb as O,kc as ie,la as E,lc as oe,m as I,ma as S,mb as V,n as b,pa as w,ra as G,ta as M,v as a,w as m,y as v}from"./chunk-CP2QVCAP.js";import"./chunk-EVXCY5NW.js";import"./chunk-JXNEG2Q2.js";import"./chunk-FUY72XGA.js";import"./chunk-EQDBGDMV.js";import"./chunk-WESY2VG5.js";import"./chunk-M2X7KQLB.js";import"./chunk-XTVTS2NW.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{f as p}from"./chunk-D7YYRZS5.js";function ae(r,d){if(r&1){let e=C();o(0,"ion-button",10),h("click",function(){I(e);let i=g();return b(i.clearRoute())}),s(1," Limpiar Ruta "),t()}}function se(r,d){if(r&1&&(o(0,"ion-item")(1,"ion-label")(2,"h3"),s(3),t(),o(4,"p"),s(5),t()()()),r&2){let e=d.$implicit;a(3),x("",e.hora," \u2013 ",e.lugar),a(2),R(e.descripcion)}}function le(r,d){if(r&1&&(o(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),s(3),t()(),o(4,"ion-card-content")(5,"ion-list"),c(6,se,6,3,"ion-item",11),t()()()),r&2){let e=g();a(3),y("Ruta por ",e.routeResult.city),a(3),u("ngForOf",e.routeResult.ruta)}}var Re=(()=>{class r{constructor(e,n,i,l){this.fb=e,this.auth=n,this.http=i,this.alertCtrl=l,this.user=null,this.routeResult=null,this.loading=!1,this.errorMessage=""}ngOnInit(){this.form=this.fb.group({city:["",T.required]}),oe(this.auth,e=>{this.user=e})}generate(){return p(this,null,function*(){if(!(!this.form.valid||!this.user)){this.loading=!0,this.routeResult=null,this.errorMessage="";try{let e=yield ie(this.user),n=new G({Authorization:`Bearer ${e}`}),l=(yield _(this.http.post("http://localhost:3000/api/pois/generate-route",{city:this.form.value.city},{headers:n}))).routePlan;try{let ne=typeof l=="string"?JSON.parse(l):l;this.routeResult=ne}catch{this.routeResult=null,this.errorMessage="La respuesta del servidor no tiene un formato v\xE1lido.",this.showErrorAlert(this.errorMessage)}}catch(e){console.error("Error generando ruta",e),this.errorMessage=e?.error?.error||"Ocurri\xF3 un error generando la ruta.",this.showErrorAlert(this.errorMessage)}finally{this.loading=!1}}})}showErrorAlert(e){return p(this,null,function*(){yield(yield this.alertCtrl.create({header:"Error",message:e,buttons:["OK"],cssClass:"custom-alert"})).present()})}clearRoute(){this.form.reset(),this.routeResult=null,this.errorMessage=""}static{this.\u0275fac=function(n){return new(n||r)(m(O),m(re),m(M),m(ee))}}static{this.\u0275cmp=v({type:r,selectors:[["app-generate-route"]],decls:16,vars:4,consts:[["color","primary"],["slot","start"],["defaultHref","/home"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["position","stacked"],["formControlName","city"],["expand","full","type","submit",3,"disabled"],["expand","full","color","medium",3,"click",4,"ngIf"],[4,"ngIf"],["expand","full","color","medium",3,"click"],[4,"ngFor","ngForOf"]],template:function(n,i){n&1&&(o(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),s(3,"Generar Ruta Personalizada"),t(),o(4,"ion-buttons",1),f(5,"ion-back-button",2),t()()(),o(6,"ion-content",3)(7,"form",4),h("ngSubmit",function(){return i.generate()}),o(8,"ion-item")(9,"ion-label",5),s(10,"Ciudad"),t(),f(11,"ion-input",6),t(),o(12,"ion-button",7),s(13," Generar Ruta "),t(),c(14,ae,2,0,"ion-button",8),t(),c(15,le,7,2,"ion-card",9),t()),n&2&&(a(7),u("formGroup",i.form),a(5),u("disabled",i.form.invalid||i.loading),a(2),u("ngIf",i.routeResult||i.errorMessage),a(),u("ngIf",i.routeResult))},dependencies:[te,H,j,L,D,z,$,q,J,K,Q,U,W,X,Y,B,Z,w,E,S,V,P,k,F,N,A],styles:[".custom-alert .alert-wrapper{border-left:6px solid red}  .custom-alert .alert-head{background-color:#f44336;color:#fff}  .custom-alert .alert-message .error-message{color:#e53935;font-weight:700}"]})}}return r})();export{Re as GenerateRoutePage};
